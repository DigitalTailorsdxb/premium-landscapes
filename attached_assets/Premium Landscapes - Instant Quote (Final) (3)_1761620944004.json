{
  "name": "Premium Landscapes - Instant Quote (Final)",
  "nodes": [
    {
      "parameters": {
        "binaryData": true,
        "name": "=\"Quote-\" + $json.customerName + \"-\" + $moment().format(\"YYYY-MM-DD\") + \".pdf\"",
        "parents": [
          "=https://drive.google.com/drive/folders/1RO45FjuBGbvFYRp8VXIxMWtuwrDHTDN7"
        ],
        "options": {}
      },
      "id": "2a377c3e-1506-4f8f-a903-199a404de48d",
      "name": "Upload PDF to Google Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 2,
      "position": [
        416,
        624
      ],
      "notesInFlow": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "t1a2DIBxTnvPKUMq",
          "name": "Google Drive account"
        }
      },
      "notes": "Uploads the PDF to /Premium Landscapes/Quotes Archive folder (creates if missing)."
    },
    {
      "parameters": {
        "functionCode": "const d = $json;\nif(!d.customer || !d.customer.email) throw new Error('Missing customer email');\nif(!d.project || !d.project.products || !Array.isArray(d.project.products) || d.project.products.length===0) throw new Error('Missing product selection');\nreturn [d];"
      },
      "id": "47edb2f0-0c90-4c8d-a138-28f574e8f871",
      "name": "Validate Input",
      "type": "n8n-nodes-base.function",
      "position": [
        -1536,
        624
      ],
      "typeVersion": 1,
      "notes": "Ensures all required fields are provided before continuing"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "options": {
          "timeout": 120000
        }
      },
      "id": "1428e7db-2962-452c-9505-369a4cf10263",
      "name": "AI Quote Enhancer (GPT-4 Turbo)",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1024,
        624
      ],
      "typeVersion": 4.2,
      "notes": "Uses GPT-4 Turbo to write a professional summary paragraph for the quote"
    },
    {
      "parameters": {
        "functionCode": "const original=$items('Calculate Pricing')[0].json;\nconst aiText=$json.choices?.[0]?.message?.content||'Quote summary unavailable';\nreturn [{json:{...original,aiSummary:aiText}}];"
      },
      "id": "203df165-f1e2-4070-aa35-5b7d0620eccf",
      "name": "Merge AI Summary",
      "type": "n8n-nodes-base.function",
      "position": [
        -784,
        624
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "functionCode": "const data=$json;\nconst logo='https://www.premium-landscapes.co.uk/logo.png';\nlet rows=data.breakdown.map(i=>`<tr><td>${i.feature}</td><td>${i.qty} ${i.unit}</td><td>Â£${i.rate}</td><td>Â£${i.subtotal.toLocaleString()}</td></tr>`).join('');\nreturn [{json:{html:`<!DOCTYPE html><html><head><style>\nbody{font-family:Inter,Arial,sans-serif;color:#111827;padding:20px;background:#fff;}\nheader{text-align:center;border-bottom:3px solid #2563EB;padding-bottom:10px;margin-bottom:20px;}\nheader img{max-height:60px;}\nh1{color:#2563EB;}\ntable{width:100%;border-collapse:collapse;margin-top:20px;}\nth{background:linear-gradient(90deg,#2563EB,#A855F7);color:white;padding:8px;text-align:left;}\ntd{padding:8px;border-bottom:1px solid #E5E7EB;}\ntfoot td{font-weight:bold;color:#2563EB;}\n.summary{margin-top:25px;padding:15px;background:#F0F9FF;border-radius:8px;}\n</style></head><body>\n<header><img src='${logo}'><h2>Premium Landscapes</h2><p>www.premium-landscapes.co.uk | info@premium-landscapes.co.uk | 07444 887813</p></header>\n<h1>Garden Quote</h1>\n<p><strong>Client:</strong> ${data.customer.name}</p>\n<p><strong>Postcode:</strong> ${data.customer.postcode||''}</p>\n<div class='summary'><h3>AI Project Overview</h3><p>${data.aiSummary}</p></div>\n<table><thead><tr><th>Feature</th><th>Qty</th><th>Rate</th><th>Subtotal</th></tr></thead><tbody>${rows}</tbody>\n<tfoot><tr><td colspan='3'>Subtotal</td><td>Â£${data.subtotal.toLocaleString()}</td></tr><tr><td colspan='3'>Contingency (10%)</td><td>Â£${data.contingency.toLocaleString()}</td></tr><tr><td colspan='3'>VAT (20%)</td><td>Â£${data.vat.toLocaleString()}</td></tr><tr><td colspan='3'><strong>Total</strong></td><td><strong>Â£${data.total.toLocaleString()}</strong></td></tr></tfoot></table>\n<footer style='margin-top:30px;text-align:center;font-size:12px;color:#555;'>All works include materials, labour, and waste removal.<br>Reply to this email to confirm or call 07444 887813.</footer>\n</body></html>`}}];"
      },
      "id": "851a6093-6241-42d1-8180-5995099ec24f",
      "name": "Build PDF HTML",
      "type": "n8n-nodes-base.function",
      "position": [
        -528,
        624
      ],
      "typeVersion": 1
    },
    {
      "parameters": {},
      "id": "b4ec6e7c-8125-4430-9011-693405bd41a2",
      "name": "HTML to PDF",
      "type": "n8n-nodes-base.htmlPdf",
      "position": [
        -288,
        624
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "fromEmail": "premiumlandscapeuk@gmail.com",
        "toEmail": "={{$json.customer.email}}",
        "subject": "Your Detailed Garden Quote from Premium Landscapes ðŸŒ¿",
        "options": {}
      },
      "id": "ea655529-7d00-475c-9713-b0d008e94158",
      "name": "Send Email",
      "type": "n8n-nodes-base.emailSend",
      "position": [
        -32,
        624
      ],
      "typeVersion": 2.1,
      "webhookId": "ab3e512a-7b66-44ee-9210-d627ca379a3d"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "sheetName": "Premium Landscapes Quotes Log",
        "options": {}
      },
      "id": "957ccd3f-3048-45ba-80e5-b44fa4cac905",
      "name": "Log Quote to Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        224,
        624
      ],
      "typeVersion": 4.7
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "bea2a72b-a48b-4201-896e-5dd6457d871f",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        624,
        624
      ],
      "typeVersion": 1.4
    },
    {
      "parameters": {},
      "id": "9e5deb04-1123-4765-85de-8f8d985d338f",
      "name": "Error Catcher",
      "type": "n8n-nodes-base.errorTrigger",
      "position": [
        -1712,
        928
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "fromEmail": "premiumlandscapeuk@gmail.com",
        "toEmail": "premiumlandscapeuk@gmail.com",
        "subject": "âŒ Workflow Error â€“ Premium Landscapes Quote",
        "options": {}
      },
      "id": "778defdf-3991-4f93-9e3f-00bbd2d79d93",
      "name": "Send Error Alert",
      "type": "n8n-nodes-base.emailSend",
      "position": [
        -1536,
        928
      ],
      "typeVersion": 2.1,
      "webhookId": "c71811cb-85dc-480e-8c5b-66741bba20e6"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "premium-landscapes-quote",
        "options": {
          "responseData": {
            "response": "Quote received successfully"
          }
        }
      },
      "id": "a2dc118b-88c6-4565-b391-a9db6f978d51",
      "name": "Webhook Trigger1",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -1776,
        624
      ],
      "typeVersion": 2.1,
      "webhookId": "18e472db-2bde-42ea-8f26-04d3f526e3f7"
    },
    {
      "parameters": {
        "functionCode": "const input = $json;\nconst priceTable = { excavation:60, subbase:25, porcelain:130, decking:120, turf:85, planters:300, firepit:1000, lighting:200 };\nlet breakdown = [];\nif (input.project.products.includes('patio')) breakdown.push({feature:'Porcelain Paving', qty:30, unit:'mÂ²', rate:priceTable.porcelain, subtotal:30*priceTable.porcelain});\nif (input.project.products.includes('decking')) breakdown.push({feature:'Composite Decking', qty:20, unit:'mÂ²', rate:priceTable.decking, subtotal:20*priceTable.decking});\nlet subtotal = breakdown.reduce((a,b)=>a+b.subtotal,0);\nlet contingency=subtotal*0.10; let vat=(subtotal+contingency)*0.20; let total=subtotal+contingency+vat;\nreturn [{json:{...input,breakdown,subtotal,contingency,vat,total}}];"
      },
      "id": "7a032c35-4595-470b-91b8-19e23c8feaa6",
      "name": "Calculate Pricing1",
      "type": "n8n-nodes-base.function",
      "position": [
        -1280,
        624
      ],
      "typeVersion": 1
    }
  ],
  "pinData": {},
  "connections": {
    "Upload PDF to Google Drive": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Input": {
      "main": [
        [
          {
            "node": "Calculate Pricing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Quote Enhancer (GPT-4 Turbo)": {
      "main": [
        [
          {
            "node": "Merge AI Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge AI Summary": {
      "main": [
        [
          {
            "node": "Build PDF HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Email": {
      "main": [
        [
          {
            "node": "Log Quote to Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Quote to Google Sheets": {
      "main": [
        [
          {
            "node": "Upload PDF to Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Catcher": {
      "main": [
        [
          {
            "node": "Send Error Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Trigger1": {
      "main": [
        [
          {
            "node": "Validate Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Pricing1": {
      "main": [
        [
          {
            "node": "AI Quote Enhancer (GPT-4 Turbo)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "868c2992-2edf-48c8-ae31-e8221f9171f4",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e1c866f51f89be40bb7a8fd6d598585ff0ef85e3ee97add539aaea059383a17d"
  },
  "id": "snCjf2HwLdipPb6v",
  "tags": []
}